@using System.Globalization
@model Employee

@{
    // Set the page title
    ViewData["Title"] = "Employee Details";

    int selectedYear = ViewBag.SelectedYear ?? DateTime.Now.Year;
    int selectedMonth = ViewBag.SelectedMonth ?? DateTime.Now.Month;
}

<!-- Centered card layout to display employee details -->
<div class="container mt-1" style="overflow-x: hidden;">
    <!-- Prevent horizontal scroll -->
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm border rounded">

                <!-- Card Header: Displays the employee's name and ID -->
                <div class="card-header bg-primary text-white text-center py-3">
                    <h2 class="mb-0">
                        <i class="bi bi-person-circle me-2"></i> @Model.FullName
                    </h2>
                    <small class="fst-italic">
                        Employee ID: <span class="fw-semibold">@Model.Id</span>
                    </small>
                </div>

                <!-- Card Body: Main details section -->
                <div class="card-body p-4">
                    <div class="table-responsive">
                        <table class="table table-borderless mb-0">
                            <tbody>
                                <!-- Email with clickable mailto link -->
                                <tr>
                                    <th class="text-muted" style="width: 30%;">📧 Email</th>
                                    <td>
                                        <a href="mailto:@Model.Email" class="text-decoration-none fw-semibold text-primary">
                                            @Model.Email
                                        </a>
                                    </td>
                                </tr>

                                <!-- Designation -->
                                <tr>
                                    <th class="text-muted">💼 Designation</th>
                                    <td class="fw-bold text-dark text-start">@Model.Designation?.Name</td>
                                </tr>

                                <!-- Department -->
                                <tr>
                                    <th class="text-muted">🏢 Department</th>
                                    <td class="fw-bold text-dark text-start">@Model.Department?.Name</td>
                                </tr>

                                <!-- Hire Date formatted -->
                                <tr>
                                    <th class="text-muted">🗓️ Hire Date</th>
                                    <td class="fw-bold text-dark text-start">
                                        @Model.HireDate.ToString("MMMM dd, yyyy", CultureInfo.InvariantCulture)
                                    </td>
                                </tr>

                                <!-- Date of Birth formatted -->
                                <tr>
                                    <th class="text-muted">🎂 Date of Birth</th>
                                    <td class="fw-bold text-dark text-start">
                                        @Model.DateOfBirth.ToString("MMMM dd, yyyy", CultureInfo.InvariantCulture)
                                    </td>
                                </tr>

                                <!-- Display the number of working days for the current month and country -->
                                <tr>
                                    <th class="text-muted">📅 Month Working Days</th>
                                    <td class="fw-bold text-dark text-start">
                                        @(ViewBag.Workdays != null ? ViewBag.Workdays.ToString() : "N/A")

                                        <!-- Inline Form to dynamically fetch working days -->
                                        <form asp-action="UpdateWorkingDays" asp-controller="Employee" method="get" class="row row-cols-auto align-items-end g-2 mt-2">
                                            <!-- Hidden field to pass employee ID -->
                                            <input type="hidden" name="id" value="@Model.Id" />

                                            <!-- Year Dropdown -->
                                            <div class="col">
                                                <label for="year" class="form-label mb-1">Select Year</label>
                                                <select name="year" id="year" class="form-select form-select-sm">
                                                    @for (int y = 1980; y <= DateTime.Now.Year; y++)
                                                    {
                                                        <option value="@y" selected="@(y == selectedYear ? "selected" : null)">@y</option>
                                                    }

                                                </select>
                                            </div>

                                            <!-- Month Dropdown -->
                                            <div class="col">
                                                <label for="month" class="form-label mb-1">Select Month</label>
                                                <select name="month" id="month" class="form-select form-select-sm">
                                                    @for (int m = 1; m <= 12; m++)
                                                    {
                                                        <option value="@m" selected="@(m == selectedMonth ? "selected" : null)">
                                                            @CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(m)
                                                        </option>
                                                    }

                                                </select>
                                            </div>

                                            <!-- Submit Button -->
                                            <div class="col">
                                                <button type="submit" class="btn btn-primary btn-sm rounded-pill px-3">
                                                    <i class="bi bi-search"></i> Get Working Days
                                                </button>
                                            </div>
                                        </form>
                                    </td>
                                </tr>

                                <!-- Employee Type -->
                                <tr>
                                    <th class="text-muted">👔 Employee Type</th>
                                    <td class="fw-bold text-dark text-start">@Model.EmployeeType?.Name</td>
                                </tr>

                                <!-- Gender -->
                                <tr>
                                    <th class="text-muted">⚧ Gender</th>
                                    <td class="fw-bold text-dark text-start">@Model.Gender</td>
                                </tr>

                                <!-- Country -->
                                <tr>
                                    <th class="text-muted">🌍 Country:</th>
                                    <td class="fw-bold text-dark text-start">@Model.Country</td>
                                </tr>

                                <!-- Country Code -->
                                <tr>
                                    <th class="text-muted">🏳️ Country Code:</th>
                                    <td class="fw-bold text-dark text-start">@Model.CountryCode</td>
                                </tr>

                                <!-- Salary formatted -->
                                <tr>
                                    <th class="text-muted">💰 Salary</th>
                                    <td class="fw-bold text-dark text-start">$@Model.Salary.ToString("N2")</td>
                                </tr>

                                <!-- Decrypted Iban -->
                                <tr>
                                    <th class="text-muted">🏦 IBAN</th>
                                    <td class="fw-bold text-dark text-start">@Model.EncryptedIBAN</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>

                    <!-- Action buttons: Only shown to users who are not in the 'Employee' role -->
                    <div class="d-flex justify-content-center gap-3 mt-4">
                        @if (!User.IsInRole("Employee"))
                        {
                            <!-- Update Button -->
                            <a class="btn btn-success btn-lg px-4 rounded-pill shadow-sm" asp-action="Update" asp-route-id="@Model.Id">
                                <i class="bi bi-pencil-fill me-2"></i> Update
                            </a>

                            <!-- Delete Button -->
                            <a class="btn btn-danger btn-lg px-4 rounded-pill shadow-sm" asp-action="Delete" asp-route-id="@Model.Id">
                                <i class="bi bi-trash-fill me-2"></i> Delete
                            </a>

                            <!-- Back to List Button -->
                            <a class="btn btn-info btn-lg px-4 rounded-pill shadow-sm text-white" asp-action="List">
                                <i class="bi bi-arrow-left-circle-fill me-2"></i> Back to List
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
